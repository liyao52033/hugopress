{{ define "main" }}
    {{ $landingData := .Site.Data.landing }}
    {{ $map := newScratch }}

    {{ range $key, $value := $landingData }}
        {{ $sectionTitle := $key }}
        {{ $weight := string $value.weight }}
        {{ $template := replaceRE `( |-{1,})` "_" $value.template | string }}
        {{ with and $template $weight }}
            {{ $map.SetInMap "wgtTpl" $sectionTitle (dict
                "weight" $weight
                "template" $template
                "sectionTitle" $sectionTitle
            )}}
        {{ end }}
    {{ end }}

    {{ range sort ($map.Get "wgtTpl") ".weight" }}
        {{ $.Scratch.Set "sectionTitle" .sectionTitle }}
        {{ $path := printf "landing/%s.html" .template }}
        {{ partial $path $.Page }}
    {{ end }}

    {{/* 获取需要显示的文章列表 */}}
    {{ $pages := where .Site.RegularPages "Type" "docs" }}
    
    {{/* 置顶文章（有 top 参数） */}}
    {{ $topPages := where $pages "Params.top" "!=" nil }}
    {{ $topPages := $topPages.ByParam "top" }}

    {{/* 普通文章（无 top 参数） */}}
    {{ $normalPages := where $pages "Params.top" "eq" nil }}
    {{ $normalPages := $normalPages.ByDate.Reverse }}

    {{/* 
        合并切片（置顶在前，普通在后）
        1、先把 $topPages（置顶文章，已按 top 升序排好）赋值给 $sorted
        2、然后遍历 $normalPages（普通文章，已按日期降序排好）
        3、在循环里，把每一篇普通文章追加到 $sorted 末尾

     */}}
    {{ $sorted := $topPages }}
    {{ range $normalPages }}
        {{ $sorted = $sorted | append . }}
    {{ end }}

    {{/* 添加分页功能 */}}
    {{ $paginator := .Paginate $sorted 10 }} {{/* 每页显示 10 篇文章 */}}

    {{/* 调用 partial 并传递参数 */}}
    {{ partial "taxonomy-and-articles.html" (dict 
        "Pages" $paginator.Pages 
        "Title" "最新文章" 
        "Site"  .Site
    ) }}

    {{/* 分页导航 */}}
    {{ if $paginator }}
    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center">
            {{ if $paginator.HasPrev }}
            <li class="page-item">
                <a class="page-link" href="{{ $paginator.Prev.URL }}">上一页</a>
            </li>
            {{ else }}
            <li class="page-item disabled">
                <span class="page-link">上一页</span>
            </li>
            {{ end }}

            {{ range $paginator.Pagers }}
            <li class="page-item {{ if eq . $paginator }}active{{ end }}">
                <a class="page-link" href="{{ .URL }}">{{ .PageNumber }}</a>
            </li>
            {{ end }}

            {{ if $paginator.HasNext }}
            <li class="page-item">
                <a class="page-link" href="{{ $paginator.Next.URL }}">下一页</a>
            </li>
            {{ else }}
            <li class="page-item disabled">
                <span class="page-link">下一页</span>
            </li>
            {{ end }}
        </ul>
    </nav>
    {{ end }}



{{ end }}
    