{{ $repoURL := slice .Site.Params.docs.repoURL }}
{{ $repoHostname := (urls.Parse (.Site.Params.docs.repoURL)).Hostname }}
{{ $filePath := replace .File.Path "\\" "/" }}
{{ $iconPath := "" }}

{{ if strings.Contains ($repoHostname | lower) "github" }}
{{ $repoURL = $repoURL | append "blob" (.Site.Params.docs.repoBranch | default "main") }}
{{ $iconPath = "images/social/github_icon.svg" }}
{{ else if strings.Contains ($repoHostname | lower) "gitlab" }}
{{ $repoURL = $repoURL | append "-/blob" (.Site.Params.docs.repoBranch | default "main") }}
{{ $iconPath = "images/social/gitlab_icon.svg" }}
{{ else if strings.Contains ($repoHostname | lower) "bitbucket" }}
{{ $repoURL = $repoURL | append "src" (.Site.Params.docs.repoBranch | default "main") }}
{{ $iconPath = "images/social/bitbucket_icon.svg" }}
{{ end }}

{{ $repoURL = $repoURL | append "content" .Site.LanguagePrefix $filePath }}
{{ $repoURL = delimit $repoURL "/" }}
{{ $editPageURL := replaceRE "(https?://)|(/)+" "$1$2" $repoURL }}

<div
    class="gitinfo d-flex flex-wrap justify-content-between align-items-center opacity-85 {{ if or .Site.Params.docs.lastMod .Site.Params.docs.editPage -}}pt-3{{ else }}visually-hidden{{ end }}">

    {{/* 编辑页面按钮，可选 */}}
    {{ if .Site.Params.docs.editPage | default false -}}
    <div id="edit-this-page" class="mt-1">
        <a href="{{ $editPageURL }}" alt="编辑 {{ .Title }}" rel="noopener noreferrer" target="_blank">
            <span class="me-1 align-text-bottom">
                {{ with resources.Get $iconPath }}
                {{ .Content | safeHTML }}
                {{ end }}
            </span>
            编辑此页面
        </a>
    </div>
    {{ end }}

    {{/* 最后修改时间信息 */}}
    {{ if and (.Site.Params.docs.lastMod | default false) .GitInfo }}
    <div id="last-modified" class="mt-1">
        <p class="mb-0 fw-semibold">
            最后更新于 <span {{ if .Site.Params.docs.lastModRelative | default false -}}id="relativetime" {{ end }}
                data-authdate="{{ dateFormat `2006-01-02T15:04:05Z0700` .Lastmod }}" {{ if
                .Site.Params.docs.lastModRelative | default false -}} title="{{ dateFormat `2006-01-02 15:04` .Lastmod }}"
                {{ end }}>
                {{ dateFormat "2006-01-02 15:04" .Lastmod }}
            </span>
            <span class="material-icons size-20 align-text-bottom opacity-75">history</span>
        </p>
    </div>

    {{ else if and (.Site.Params.docs.lastMod | default false) (not .GitInfo) }}
    <!-- 调试信息：GitInfo 为空 -->
    <div id="last-modified" class="mt-1">
        <p class="mb-0 fw-semibold text-warning">未找到 Git 修改信息</p>
    </div>
    {{ end }}

</div>