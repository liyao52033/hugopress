# Hugo 自动截断功能 Markdown 使用文档

## 功能概述

Hugo 自动截断功能可根据文章字数阈值或手动标记，自动将长文章分割为 “首屏显示内容” 和 “触发式展开内容”，支持**手动点击**、**滚动距离**、**视口可见**三种展开触发模式，无需手动修改模板，仅通过 Markdown 前置参数或简单标记即可控制。

## 核心优势

1. 零侵入：无需修改文章内容结构，仅通过前置参数 / 标记控制；
2. 多模式：手动点击 / 滚动触发 / 视口触发自由切换；
3. 自适应：中英文自动识别，按字符 / 单词数精准截断；
4. 易扩展：全局配置统一管理，单篇文章可覆盖默认规则。

## 前置准备（已配置完成可跳过）

确保项目中已配置：

- `data/vif/config.yaml`：自动截断核心配置文件；
- `static/js/v-if-core.js`：触发逻辑核心 JS；
- `baseof.html`：集成自动截断逻辑的主模板；
- `static/css/vif-style.css`：样式文件（可选）。

## 基础使用（无需任何标记）

### 场景：默认自动截断

无需在 Markdown 中添加任何标记 / 参数，系统会根据 `data/vif/config.yaml` 中的全局配置自动判断：

- 文章字数超过阈值 → 自动分割，后半部分按默认触发模式展开；
- 文章字数未超阈值 → 完整显示，无展开按钮。

```markdown
---
title: 基础自动截断示例
date: 2025-12-14
# 无需任何额外参数，使用全局默认配置
---

这是文章的首屏内容，会直接显示...

（此处省略大量内容，字数超过全局阈值后）

这部分内容会被自动封装到展开区块，需触发后显示...
```

## 进阶使用（自定义触发模式）

通过 Markdown 前置参数覆盖全局默认触发模式，支持三种模式自由选择。

### 模式 1：手动点击触发（推荐）

通过前置参数 `vif_trigger_type: "manual"` 设置，显示 “展开更多” 按钮，点击后加载隐藏内容。

```markdown
---
title: 手动点击触发示例
date: 2025-12-14
vif_trigger_type: "manual"  # 手动触发模式
# 可选：自定义按钮文字（需全局配置支持）
# vif_toggle_text: "点击查看全文"
---

文章首屏内容...

（字数超阈值后）

隐藏内容：点击按钮后显示，隐藏时 DOM 节点自动移除，优化首屏性能...
```

### 模式 2：滚动距离触发

通过前置参数设置滚动阈值，页面滚动到指定像素后自动加载隐藏内容。

```markdown
---
title: 滚动距离触发示例
date: 2025-12-14
vif_trigger_type: "scroll"        # 滚动触发模式
vif_scroll_threshold: 800         # 滚动 800px 后触发（默认 500px）
---

文章首屏内容...

（滚动到 800px 位置后）

隐藏内容自动加载，无需点击，适合长页面沉浸式阅读...
```

### 模式 3：视口可见触发

通过前置参数设置视口可见比例，隐藏内容进入视口指定比例后自动加载。

```markdown
---
title: 视口可见触发示例
date: 2025-12-14
vif_trigger_type: "viewport"      # 视口触发模式
vif_viewport_threshold: 0.3       # 内容 30% 进入视口后触发（默认 0.1）
---

文章首屏内容...

（隐藏内容区域进入视口 30% 后）

自动加载，性能最优的懒加载方案...
```

## 精准控制分割点（手动标记）

若需精准控制分割位置，而非依赖字数阈值，可在文章中插入 `<!--more-->` 标记，系统会强制在标记处分割。

### 使用示例

```markdown
---
title: 精准分割示例
date: 2025-12-14
vif_trigger_type: "manual"
---

这部分内容会直接显示...

<!--more-->  <!-- 强制分割标记 -->

这部分内容会被封装到展开区块，无论字数多少，仅在触发后显示...
```

### 注意事项

- `<!--more-->` 标记优先级高于字数阈值，插入后强制分割；
- 标记可放在文章任意位置（段落间 / 行内），建议单独一行放置，避免格式错乱。

## 禁用自动截断（单篇例外）

若某篇文章无需截断（即使字数超标），可通过前置参数禁用：

```markdown
---
title: 禁用自动截断示例
date: 2025-12-14
vif_auto_split: false  # 禁用自动截断，完整显示所有内容
---

文章所有内容会直接完整显示，无展开按钮/触发逻辑...
```

## 全局配置参考（快速调整）

核心配置文件 `data/vif/config.yaml` 可统一管理规则，无需修改 Markdown：

```yaml
# 自动截断规则
auto_split:
  enable: true                          # 全局开启/关闭自动截断
  en_word_threshold: 500                # 英文单词阈值（默认 500）
  cn_char_threshold: 1500               # 中文字符阈值（默认 1500）
  paragraph_ratio: 0.6                  # 自动截断保留前 60% 段落
  manual_marker: "<!--more-->"          # 手动分割标记

# 触发模式默认配置
trigger:
  default_type: "viewport"              # 全局默认触发模式：manual/scroll/viewport
  scroll_threshold: 500                 # scroll 模式默认阈值（px）
  viewport_threshold: 0.1               # viewport 模式默认可见比例

# 样式/文案配置
style:
  toggle_btn_text: "展开更多内容"       # 手动模式按钮文字
  toggle_btn_class: "v-if-toggle-btn"   # 按钮 CSS 类名
  hidden_content_class: "v-if-hidden-content" # 隐藏内容容器类名
```

## 常见问题

### Q1：手动触发模式下，点击按钮无反应？

- 检查浏览器控制台是否有 JS 报错，确认 `v-if-core.js` 已正确加载；
- 确认文章前置参数 `vif_trigger_type: "manual"` 拼写正确；
- 确认 `name` 参数唯一（系统自动生成，无需手动设置）。

### Q2：中文文章未触发自动截断？

- 检查 `cn_char_threshold` 配置值是否过小（建议中文设置 1500+）；
- 确认文章无连续空格导致字数统计异常；
- 可插入 `<!--more-->` 标记强制分割。

### Q3：滚动 / 视口触发模式不生效？

- 滚动触发：确认 `vif_scroll_threshold` 值小于页面总高度；
- 视口触发：确认隐藏内容区域不在首屏（可通过 `margin-top` 推到下方测试）；
- 检查是否有其他 JS 阻塞了滚动 / 视口监听逻辑。

## 最佳实践

1. 全站默认：全局配置 `trigger.default_type: "viewport"`，兼顾性能和体验；
2. 长文优化：对超长篇文章（如教程 / 文档），使用 `vif_trigger_type: "manual"`，让用户自主选择是否展开；
3. 样式统一：通过 `vif-style.css` 自定义展开按钮样式，适配网站主题；
4. 性能监控：通过浏览器 Network/Elements 面板，确认隐藏内容初始 DOM 未加载，触发后动态插入。